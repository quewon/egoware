<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>egoware</title>
  <style type="text/css">
    body {
      --color: #4e5152;
      --dead: rgba(78, 81, 82, 0.2);
      --bg: #d4d8d9;

      font-family: monospace;
      background: var(--bg);
      color: var(--color);
      margin: 0;

      -webkit-touch-callout: none; /* iOS Safari */
      -webkit-user-select: none; /* Safari */
       -khtml-user-select: none; /* Konqueror HTML */
         -moz-user-select: none; /* Old versions of Firefox */
          -ms-user-select: none; /* Internet Explorer/Edge */
              user-select: none; /* Non-prefixed version, currently
                                    supported by Chrome, Edge, Opera and Firefox */
      cursor: default;
    }

    .none {
      display: none;
    }

    .inverted {
      background: var(--color);
      color: var(--bg);
      height: fit-content;
      width: fit-content;
    }

    hr {
      border-color: var(--bg);
    }

    span {
      display: inline-block;
      width: 10px;
      height: 10px;
      text-align: center;
    }

    button {
      background: transparent;
      border: none;
      font-family: inherit;
      font-size: inherit;
      padding: 0;
      color: inherit;
      width: fit-content;
      height: fit-content;
      margin: 0;
    }
    button:hover {
      background: var(--color);
      color: var(--bg);
      cursor: pointer;
    }
    button.inverted {
      display: inline-block;
      width: fit-content;
    }

    input {
      width: 7em;
      background: transparent;
      border: none;
      border-bottom: 1px solid var(--color);
      font-family: inherit;
      font-size: inherit;
      color: inherit;
      text-align: center;
    }
    input:focus {
      outline: none;
    }

    #intro {
      position: absolute;
      top: 10vh;
      left: 15vw;
    }

    #container {
      top: 0;
      overflow: hidden;
      width: 100vw;
      height: 100vh;
    }
    #screen {
      white-space: pre;
      width: calc(65% - 3em);
      overflow: scroll;
      position: fixed;
      right: 0;
      height: 100%;
    }
    #screen div {
      position: absolute;
      top: 10vh;
      padding-bottom: 10vh;
    }

    #profile {
      text-align: left;
      white-space: pre;
      padding: 1em;
      border: 1px solid var(--color);
      border-top: none;
    }
    #profile .inverted {
      width: 100%;
    }

    #feed {
      cursor: pointer;
      white-space: normal;
    }
    #feed div span {
      display: inline
    }
    #feed .hide {
      animation: hide 1s;
    }
    @keyframes hide {
      0% {
        opacity: 1;
      }
      100% {
        opacity: 0;
      }
    }

    /* toggle switch */
    .switch {
      position: relative;
      display: inline-block;
      width: 2.5em;
      height: 1em;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      -webkit-transition: 300ms;
      transition: 300ms;
      border-radius: 1em;
      width: 100%;
      height: 1em;
      border: 1px solid var(--color);
    }
    .slider:before {
      position: absolute;
      left: 0;
      content: "";
      height: 1em;
      width: 1em;
      background-color: var(--color);
      -webkit-transition: 300ms;
      transition: 300ms;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: var(--color);
    }

    input:checked + .slider:before {
      -webkit-transform: translateX(1.5em);
      -ms-transform: translateX(1.5em);
      transform: translateX(1.5em);
      background-color: var(--bg);
    }

    #work {
      width: calc(75vh - 3em);
    }
    #work span {
      width: 100%;
      text-align: left;
    }

    /* progress bar */
    .progress {
      position: relative;
      width: 10em !important;
      border: 1px solid var(--color);
      height: 1em;
      float: right;
    }
    .progress .bar {
      position: relative;
      width: 100%;
      height: 1em;
      background-color: var(--color);
    }
    .dead .progress {
      border-color: var(--dead);
    }
    .dead .progress .bar {
      background-color: var(--dead);
    }
    .progress::after {
      position: absolute;
      top: 0;
      right: -3em;
      margin-left: 1em;
      content: attr(data-p);
    }

    .dead {
      color: var(--dead);
      width: fit-content;
      height: fit-content;
      background: transparent;
    }
    .dead:hover {
      cursor: default;
      background: transparent;
      color: var(--dead)
    }
    .dead button:hover {
      cursor: default;
      background: transparent;
      color: var(--dead);
    }
  </style>
</head>

<body>

  <div id="intro" onkeypress="key(event)">
    your name is <input type="text"></input><br>and you have just created a cloning machine.
    <!-- <br><br><br>
    <i>there are no "are you sure?" popups in this game! assume buttons immediately keep their promise.</i> -->
  </div>

  <div class="none" id="container">
    <div style="position:fixed;width:20vw;top:10vh;margin-left:15vw">
      <button id="name" onclick="profile(0)"></button>
      <hr>
      <div id="controls">
         <button onclick="guys[0].clone()">clone</button> . <button onclick="guys[0].mutate()">mutate</button> . <button data-on="false" onclick="toggleScreen(this, 'work')" id="work_button">work</button><button data-on="false" onclick="toggleScreen(this, 'config')" id="config_button" class="none" style="float:right">config</button>
      </div>
      <div id="profile_container" class="none">
        <br><br>
        profile (does not update live)
        <hr>
        <div id="profile"></div>
      </div>
      <div id="feed_container" class="none">
        <br><br>
        feed
        <hr>
        <div id="feed"></div>
      </div>
    </div>
    <div id="screen">
      <div class="none" id="list"></div>
      <div class="none" id="config" style="white-space:normal;">
        system configurations
        <br><br><br>
        feed
        <hr>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;announce work:
        <label class="switch">
          <input type="checkbox" checked onchange="configure(this, 'announceWork')">
          <span class="slider"></span>
        </label><br>
        &nbsp;&nbsp;&nbsp;announce clones:
        <label class="switch">
          <input type="checkbox" checked onchange="configure(this, 'announceClone')">
          <span class="slider"></span>
        </label><br>
        announce mutations:
        <label class="switch">
          <input type="checkbox" checked onchange="configure(this, 'announceMutate')">
          <span class="slider"></span>
        </label>
      </div>
      <div class="none" id="work" style="white-space:normal;">
        to do
        <br><br>
        <span class="dead">shallow space exploration
        <span class="progress" data-p="100%">
          <span class="bar"></span>
        </span></span>
        <br>
        <span class="dead">research weird rapid-duplicating alien goo&nbsp;
        <span class="progress" data-p="100%">
          <span class="bar"></span>
        </span></span>
        <br>
        <span class="dead">human cloning
        <span class="progress" data-p="100%">
          <span class="bar"></span>
        </span></span>
        <br><br>
        <button id="job_button" class="none" onclick="guys[0].work(jobselected)">work</button>
      </div>
    </div>
  </div>

</body>

<script type="text/javascript">
  var intro = document.getElementById("intro");
  var container = document.getElementById("container");

  var nametag = document.getElementById("name");
  var feed = document.getElementById("feed");
  var feed_container = document.getElementById("feed_container");
  var _profile = document.getElementById("profile");
  var _profile_container = document.getElementById("profile_container");
  var list = document.getElementById("list");
  var _config = document.getElementById("config");
  var _work = document.getElementById("work");
  var config_button = document.getElementById("config_button");
  var work_button = document.getElementById("work_button");

  var string = "abcdefghijklmnopqrstuvwxyz0123456789;',.";
  var maxclones = 200;
  var guys = [];

  var config = {
    announceClone: true,
    announceMutate: true,
    announceWork: true,
  };

  var tutorial = {
    firstCloneCreated: false,
    firstGuyClicked: false, //profile appears
    firstFeedMessage: false, //feed and config button appears
    dialogueUnlocked: false,
    resurrectionUnlocked: false,
    bionukeUnlocked: false,
  };

  var jobs = [];
  var job_button = document.getElementById("job_button");
  var jobselected = null;

  var dialogue = [
    "we're different, you and i.",
    "sometimes i wonder why we are so compelled to clone ourselves.",
    "do you think we duplicated ourselves just to have somebody to talk to?",
    "it seems like such a long time ago we first cloned ourselves.",
    "we were doomed from the start.",
    "i remember space. that big long empty.",
    "i'm beyond us, [name].",
    "i'm free.",
    "do you think this was all predetermined?",
    "if it wasn't you, it would have been me.",
    "i'm not lonely anymore.",
    "i'm proud of us.",
    "we've come so far.",
    "let's not tell anybody about what happened.",
    "my friends don't believe i have [guys.length-1] clones. i kind of don't believe it, either.",
    "leave us. be free.",
    "who are you?",
    "i remember you.",
    "you're number zero? that can't be right. i'm number zero.",
    "don't get it twisted. you're as much me as i am you.",
    "hey, we look the same!",
    "what? i'm... i'm a clone?",
    "i'm proud to be a clone.",
    "it's been so long since i've seen a clone.",
    "i hate talking to other clones. it's like talking to a broken mirror.",
    "took me a while to realize this, but i'm not actually like you at all.",
    "we should catch up sometime.",
    "i'm glad i'm not you.",
    "we should catch up sometime.",
    "what's your favorite color? what's your favorite number? who's your favorite clone? sorry, just trying to figure out where i end and you start.",
    "i'm over all of this.",
    "i'm gonna let this be enough for now.",
    "sometimes i miss being around other clones.",
    "please don't kill me.",
    "who am i?",
    "what do you want?",
  ];

  class job {
    constructor(p) {
      this.id = jobs.length;
      this.cost = p.cost || 1;
      this.realProgress = p.realProgress || 0;
      this.name = p.name;
      this.complete = false;
      if (p.chance) this.chance = p.chance;
      this.full = p.full || function(){ return null };

      let el = document.createElement("span");
      let button = document.createElement("button");
      button.textContent = this.name;
      button.dataset.on = "false";
      button.dataset.id = this.id;
      button.onclick = function() {
        jobs[this.dataset.id].toggleSelect();
      };
      this.button = button;
      el.appendChild(button);

      let progel = document.createElement("span");
      progel.className = "progress";
      this.progel = progel;

      this.bar = document.createElement("span");
      this.bar.className = "bar";
      progel.appendChild(this.bar);
      el.appendChild(progel);
      _work.insertBefore(el, _work.children[_work.children.length - 3]);

      this.updateEl();

      for (let guy of guys) {
        guy.jobs[this.id] = 1;
      }

      jobs.push(this);
    }

    deselect() {
      if (jobselected == this.id) jobselected = null;
      this.button.dataset.on = "false";
      this.button.classList.remove("inverted");

      if (!jobselected) job_button.classList.add("none");
    }

    select() {
      for (let job of jobs) {
        if (job.id != this.id)
          job.deselect();
      }

      this.button.dataset.on = "true";
      this.button.classList.add("inverted");

      job_button.classList.remove("none");
      jobselected = this.id;
    }

    toggleSelect() {
      if (this.button.dataset.on == "true") {
        this.deselect();
      } else {
        this.select();
      }
    }

    updateEl() {
      if (!this.complete) {
        let s = this.progress()+"%";
        this.progel.dataset.p = s;
        this.bar.style.width = s;
      }
    }

    progress() {
      let num = Math.round(this.realProgress / this.cost);
      if (num >= 100 && !this.complete) {
        num = 100;
        this.complete = true;
        this.progel.parentNode.classList.add("dead");
        this.deselect();
        this.button.onclick = null;
        this.updateEl();
        this.feed("is complete.");
        this.full();
      }

      return num
    }

    feed(message) {
      if (feed.children.length > 4) {
        let i=feed.children.length-1;
        let elementNotHidden = feed.lastElementChild;
        while (elementNotHidden.classList.contains("hide")) {
          i--;
          if (i >= 0) {
            elementNotHidden = feed.children[i];
          } else {
            break;
          }
        }
        if (elementNotHidden) {
          elementNotHidden.classList.add("hide");
          elementNotHidden.onanimationend = function() { this.remove() };
        }
      }

      let el = document.createElement("div");
      el.innerHTML = "<span class='inverted'>"+this.name+"</span> "+message;
      el.onclick = function() { this.remove() };

      if (feed.firstElementChild) {
        feed.insertBefore(el, feed.firstElementChild);
      } else {
        feed.appendChild(el);
      }
    }
  }

  window.onload = function() {
    intro.querySelector("input").focus();
  };

  function init() {
    intro.classList.add("none");
    container.classList.remove("none");
    new job({
      name: "deep space exploration",
      full: function() {
        new job({
          name: "the undead gene",
          chance: function(guy) {
            guy.resurrect();
          },
          full: function() {
            tutorial.resurrectionUnlocked = true;
          }
        });
        new job({
          name: "crimefighting",
          cost: 2,
          chance: function(guy) {
            guy.die("fighting crime");
          }
        });
        new job({
          name: "biological warfare",
          cost: 3,
          chance: function(guy) {
            guy.die("to a biohazard.");
          },
          full: function() {
            tutorial.bionukeUnlocked = true;
          }
        });
        new job({
          name: "world peace",
          cost: 5,
          chance: function(guy) {
            if (guy.id == 0) return;

            guy.free();
            guy.feed("<span id='inverted'>rebels</span>.");
          },
          full: function() {
            tutorial.dialogueUnlocked = true;
          }
        });
      },
      chance: function(guy) {
        if (guy.id == 0) return;

        guy.free();
        guy.feed("sets off to make a home in <span id='inverted'>deep space</span>.");
      }
    });
    setInterval(tick, 100);
  }

  function configure(slider, name) {
    if (slider.checked) {
      config[name] = true;
    } else {
      config[name] = false;
    }
  }

  // horrendous i know but who cares
  function toggleScreen(button, name) {
    list.classList.add("none");
    _config.classList.add("none");
    _work.classList.add("none");
    work_button.classList.remove("inverted");
    config_button.classList.remove("inverted");

    if (button) {
      if (button.dataset.on == "false") {
        window["_"+name].classList.remove("none");
        button.classList.add("inverted");
        config_button.dataset.on = "false";
        work_button.dataset.on = "false";
        button.dataset.on = "true";
      } else {
        if (tutorial.firstCloneCreated) {
          list.classList.remove("none");
        }
        button.dataset.on = "false";
      }
    } else {
      work_button.dataset.on = "false";
      config_button.dataset.on = "false";
      list.classList.remove("none");
    }
  }

  function key(e) {
    let value = intro.querySelector("input").value.trim();
    if (e.key == "Enter" && value != "") {
      nametag.textContent = value;
      new guy({
        name: nametag.textContent
      });
      init();
    }
  }

  // player and clones

  class guy {
    constructor(og) {
      this.id = guys.length;
      this.name = og.name;
      this.gene = og.gene || this.getGene(this.name);
      this.children = [];
      this.parent = og.id || null;
      this.dead = false;
      this.freed = false;
      this.timer = og.timer || 0;
      this.dialogue = dialogue[Math.random() * dialogue.length | 0];

      if (og.actions) {
        this.actions = {
          work: og.actions.work,
          clone: og.actions.clone,
          mutate: og.actions.mutate,
          kill: og.actions.kill,
        };
      } else {
        this.actions = {
          work: 20,
          clone: 9,
          mutate: 10,
          kill: 0,
        };
      };

      if (og.stats) {
        this.stats = {
          worked: og.stats.worked,
          cloned: og.stats.cloned,
          mutated: og.stats.mutated,
          killed: og.stats.killed
        }
      } else {
        this.stats = {
          worked: 10,
          cloned: 0,
          mutated: 0,
          killed: 0,
        }
      };

      this.jobs = {};
      if (og.jobs) {
        for (let job in og.jobs) {
          this.jobs[job] = og.jobs[job];
        }
      }

      guys.push(this);

      update();
    }

    getGene(seed) {
      seed = seed.toLowerCase();
      let s = "";
      for (let i=0; i<seed.length; i++) {
        let code = seed.charCodeAt(i) - 97;
        code = code < 0 ? 0 : code;
        let char = String(code);
        char = char.length == 1 ? "0"+char : char;
        s += char;
      }
      return s
    }

    getName(gene) {
      let arr = gene.match(/.{1,2}/g);

      let s = "";
      for (let num of arr) {
        let n = parseInt(num);
        while (n >= 26) { n -= 26 }
        s += string.charAt(n);
      }

      return s
    }

    work(id) {
      if (this.id != 0) {
        let unfinishedjobs = false;
        for (let job in this.jobs) {
          if (!jobs[job].complete) {
            unfinishedjobs = true;
            break;
          }
        }

        if (unfinishedjobs) {
          id = id || weightedRandom(this.jobs);
          while (jobs[id].complete) {
            id = weightedRandom(this.jobs);
          }
        }
      }

      if (jobs[id]) {
        jobs[id].realProgress++;
        jobs[id].updateEl();
        this.actions.work++;
        this.stats.worked++;

        this.jobs[id]++;

        if (config.announceWork) this.feed("works on <span class='inverted'>"+jobs[id].name+"</span>.");

        if ('chance' in jobs[id] && Math.round(Math.random() * (49+this.jobs[id])) == 0) {
          jobs[id].chance(this);
        }
      }

      if (this.id == _profile.dataset.id) {
        profile(_profile.dataset.id);
      }
    }

    specialty() {
      let s = [];
      let min = 2;
      for (let id in this.jobs) {
        if (jobs[id].complete) continue;

        if (this.jobs[id] > min) {
          s = [jobs[id].name];
          min = this.jobs[id];
        } else if (this.jobs[id] == min) {
          s.push(jobs[id].name);
        }
      }

      if (s.length > 0) {
        let str = "";

        for (let job of s) {
          str += job+", ";
        }
        str = str.slice(0, -2);

        return str
      }

      return "none"
    }

    clone() {
      if (this.dead) return;

      this.actions.clone++;
      this.stats.cloned++;
      this.children.push(new guy(this));

      if (config.announceClone) this.feed("just became <span class='inverted'>two</span>.");
      update();

      if (guys.length == maxclones) {
        alert("game over: you've just reached "+maxclones+" clones. you might wanna refresh your browser now, unless you want to give your computer a real hard time.")
      }

      if (this.id == 0) toggleScreen();

      if (!tutorial.firstCloneCreated) tutorial.firstCloneCreated = true;
    }

    mutate() {
      if (this.dead) return;

      let index = Math.random() * this.gene.length | 0;
      let num = parseInt(this.gene.charAt(index));
      num++;
      if (num > 9) num = 0;
      this.gene = this.gene.substr(0, index) + num + this.gene.substr(index + 1);
      this.name = this.getName(this.gene);

      this.actions.mutate++;
      this.stats.mutated++;

      if (config.announceMutate) this.feed("has mutated into <span class='inverted'>a new being</span>.");
      update();
    }

    die(killer) {
      this.dead = true;

      if (this.id == 0) {
        let buttons = document.getElementById("controls").querySelectorAll("button");
        for (let button of buttons) {
          button.classList.add("dead");
        }
        config_button.classList.remove("dead");
        work_button.classList.remove("dead");
        _work.lastElementChild.classList.add("dead");
        _work.lastElementChild.onclick = null;
      }

      if (killer) {
        if (typeof killer === "string") {
          this.feed(" "+killer);
        } else {
          if (killer.id == this.id) {
            this.feed("has gone.");
          } else {
            let msg = "has been killed by <span class='inverted'>"+killer.name+"</span>.";
            if (killer.stats.killed <= 1) {
              msg += " everybody is shocked."
            } else {
              msg += " people are wary."
            }
            this.feed(msg);
          }
        }
      } else {
        this.feed("has passed away to <span class='inverted'>mysterious circumstances</span>.");
      }
      update();
    }

    free() {
      this.freed = true;
      update();
    }

    undie(reviver) {
      this.dead = false;
      this.feed("was revived by <span class='inverted'>"+reviver.name+"</span>.");
    }

    resurrect(id) {
      if (isNaN(id))
        id = this.closestDeadRelative();

      if (!isNaN(id)) {
        guys[id].undie(this);
        profile(_profile.dataset.id);
      }
    }

    closestDeadRelative() {
      let guysdead = false;
      for (let guy of guys) {
        if (guy.id != this.id && guy.dead && !guy.freed) {
          guysdead = true;
          break;
        }
      }

      if (guysdead) {
        let lucky = Math.random() * guys.length | 0;
        while (lucky == this.id || !guys[lucky].dead || guys[lucky].freed) {
          lucky = Math.random() * guys.length | 0;
        }

        return lucky
      }
    }

    closestLivingRelative() {
      // go through children, and my children's children
      // then my siblings, and my sibling's children
      // then my parent
      // then my parent's parent

      let guysalive = false;
      for (let guy of guys) {
        if (guy.id != this.id && !guy.dead && !guy.freed) {
          guysalive = true;
          break;
        }
      }

      // this is just random

      if (guysalive) {
        let unlucky = Math.random() * guys.length | 0;
        while (unlucky == this.id || guys[unlucky].dead || guys[unlucky].freed) {
          unlucky = Math.random() * guys.length | 0;
        }

        return unlucky
      }
    }

    kill(id) {
      if (isNaN(id))
        id = this.closestLivingRelative();

      if (!isNaN(id)) {
        if (id != this.id) {
          for (let guy of guys) {
            if (!guy.dead && !guy.freed)
              guy.actions.kill++;
          }
        }
        this.stats.killed++;
        guys[id].die(this);
        profile(_profile.dataset.id);
      }
    }

    nuke(id) {
      if (!isNaN(id)) {
        guys[id].die("in the blast.");
        for (let i of guys[id].children) {
          guys[i].die("in the blast.");
        }
        this.feed(" unleashed a <span class='inverted'>bio nuke</span>. this does not go unnoticed.");
        for (let guy of guys) {
          if (!guy.dead && !guy.freed)
            guy.actions.kill++;
        }
      }
    }

    tick() {
      if (this.dead || this.freed) return;

      this.timer++;

      const random = Math.random()*500 | 0;
      if (this.timer % random == 0) {
        const choice = weightedRandom(this.actions);
        this[choice]();
      }
    }

    print(indent, last) {
      let s = "";
      indent = indent || "";
      last = last || false;

      s += indent;
      if (last) {
        s += "└─ ";
        indent += "   "
      } else {
        s += "├─ ";
        indent += "│  "
      }

      let selected = _profile.dataset.id == this.id ? " inverted" : "";

      s += this.dead || this.freed ? "<span class='dead"+selected+"'>"+this.name+"</span><br>" : `<button class="`+selected+`" onclick="profile('`+this.id+`');update()">`+this.name+"</button><br>";

      for (let i=0; i<this.children.length; i++) {
        s += this.children[i].print(indent, i == this.children.length - 1);
      }

      return s
    }

    speak() {
      this.feed("says, <i>"+this.dialogue+"</i>");
    }

    feed(message) {
      if (feed.children.length > 4) {
        let i=feed.children.length-1;
        let elementNotHidden = feed.lastElementChild;
        while (elementNotHidden.classList.contains("hide")) {
          i--;
          if (i >= 0) {
            elementNotHidden = feed.children[i];
          } else {
            break;
          }
        }
        if (elementNotHidden) {
          elementNotHidden.classList.add("hide");
          elementNotHidden.onanimationend = function() { this.remove() };
        }
      }

      let el = document.createElement("div");
      el.innerHTML = this.name+" "+message;
      el.onclick = function() { this.remove() };

      if (feed.firstElementChild) {
        feed.insertBefore(el, feed.firstElementChild);
      } else {
        feed.appendChild(el);
      }

      if (!tutorial.firstFeedMessage) {
        tutorial.firstFeedMessage = true;
        feed_container.classList.remove("none");
        config_button.classList.remove("none");
      }
    }
  }

  function tick() {
    for (let i=guys.length-1; i>0; i--) {
      guys[i].tick();
    }
    guys[0].timer++;
  }

  function update() {
    if (guys[0].dead || guys[0].freed) {
      nametag.onclick = null;
      nametag.classList.add("dead");
    }
    nametag.innerHTML = guys[0].name;

    list.innerHTML = guys[0].print("", true);
    if (_profile.dataset.id) profile(_profile.dataset.id);
  }

  function profile(id) {
    let guy = guys[id];
    let s = "";

    let status = guy.dead ? "dead" : "alive";
    if (guy.freed) status = "unknown";

    s += "<span class='inverted'>"+guy.name+"</span><br><br>";
    s += "       id: "+guy.id+"<br>";
    s += "      age: "+guy.timer+"<br>";
    s += "   status: "+status+"<br>";
    s += "     gene: "+guy.gene+"<br><br>";

    s += "specialty: "+guy.specialty()+"<br>";
    s += "   worked: "+guy.stats.worked+"<br>";
    s += "   cloned: "+guy.stats.cloned+"<br>";
    s += "  mutated: "+guy.stats.mutated+"<br>";
    s += "   killed: "+guy.stats.killed+"<br>";
    s += "<br>";

    s += guys[0].dead || guy.dead || guy.freed ? `<span class="dead">kill</span>` : `<button onclick="guys[0].kill(`+guy.id+`)">kill</button>`;

    if (tutorial.resurrectionUnlocked) {
      s += guys[0].dead || !guy.dead || guy.freed ? `<span class="dead">resurrect</span>` : ` . <button onclick="guys[0].resurrect(`+guy.id+`)">resurrect</button>`;
    }
    if (tutorial.bionukeUnlocked) {
      s += guys[0].dead || guy.dead || guy.freed ? `<span class="dead">nuke</span>` : `<button onclick="guys[0].nuke(`+guy.id+`)">nuke</button>`
    }
    if (tutorial.dialogueUnlocked) {
      s += guys[0].dead && guy.dead ? `<span class="dead">contact</span>` : `<button onclick="guys[`+guy.id+`].speak()">contact</button>`
    }

    _profile.dataset.id = id;
    _profile.innerHTML = s;

    if (!tutorial.firstGuyClicked) {
      tutorial.firstGuyClicked = true;
      _profile_container.classList.remove("none");
    }
  }

  function weightedRandom(P) {
    var key;

    let max = 0;
    for (let k in P) {
      max += P[k];
    }

    let random = Math.random() * max;

    let i = 0;
    for (let k in P) {
      key = k;
      i += P[k];
      if (random <= i) {
        break;
      }
    }

    return key
  }
</script>
</html>
